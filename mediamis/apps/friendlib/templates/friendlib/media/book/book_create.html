{% extends "friendlib/media/media_create.html" %}
{% load i18n %}

{% block media_create %}
    <legend>{% trans "Create new book" %}</legend>

    <hr>
        <div id="websearch" class="form-search" style="padding-bottom: 15px;">{% csrf_token %}
            <label>Search a book on internet ...</label>

            <input id="query" type="input-search">
            <a id="go" class="btn">Search</a>
        </div>

        <div id="websearch_result">
<ul class="thumbnails"><li class="span2"><a id="load_details" web_id="hWByX5-c5SIC" href="#"><img src="/media//img/book_default.jpg">Alice's Adventures in Wonderland - Lewis Carroll</a></li><li class="span2"><a id="load_details" web_id="4S9lqLKg2A0C" href="#"><img src="/media//img/book_default.jpg">Alice Munro - Coral Ann Howells</a></li><li class="span2"><a id="load_details" web_id="teTS-_J6dskC" href="#"><img src="/media//img/book_default.jpg">Alice - Stacy A. Cordery</a></li><li class="span2"><a id="load_details" web_id="IvFkk1JSxz4C" href="#"><img src="/media//img/book_default.jpg">Alice Hamilton - Barbara Sicherman</a></li><li class="span2"><a id="load_details" web_id="uztS1-M40uQC" href="#"><img src="/media//img/book_default.jpg">Alice Walker - Maria Lauret</a></li></ul>
{#            <ul class="thumbnails">#}
{#                <li class="span2">#}
{#                    <a id="load_details" web_id="7680123456" href="#"><img src="/gbooks/example/img/medecin.jpg"/></a>#}
{#                    <a href="#">Le medecin de campagne</a>#}
{#                </li>#}
{#                <li class="span2"><img src="/gbooks/example/img/book21.jpg"/><a href="#">The Royal Tour</a></li>#}
{#                <li class="span2"><img src="/gbooks/example/img/books18.jpg"/><a href="#">Balzac</a></li>#}
{#                <li class="span2"><img src="/gbooks/example/img/books18.jpg"/><a href="#">Balzac</a></li>#}
{#                <li class="span2"><img src="/gbooks/example/img/books18.jpg"/><a href="#">Balzac</a></li>#}
{#                <li class="span2"><img src="/gbooks/example/img/books18.jpg"/><a href="#">Balzac</a></li>#}
{#            </ul>#}
        </div>
    
    <hr>
	<form class="form-horizontal" method="POST" action="{% url book_create %}">{% csrf_token %}
        <legend>Edit</legend>
        {% include "friendlib/snippets/media_form_field.html" with field=form.title %}

        {% include "friendlib/snippets/media_form_field.html" with field=form.description %}

        {% include "friendlib/snippets/media_form_field.html" with field=form.author %}

        {% include "friendlib/snippets/media_form_field.html" with field=form.size %}

        {% include "friendlib/snippets/media_form_field.html" with field=form.nb_pages %}

    
        {# Hidden fields #}
        {{ form.specialization_type }}
        {{ form.owner }}
		<input class="btn btn-primary" type="submit" value="{% trans "Create" %}" />
	</form>
{% endblock media_create %}

{% block js %}
    function websearch() {
        query = $('#websearch > input#query').val();
        csrf = $('#websearch input[name=csrfmiddlewaretoken]').val();
        console.log("Search with " + query);
        $('#websearch_result').load(
            '{% url book_websearch %}',
            {
                'action': 'search',
                'query': query,
                'csrfmiddlewaretoken': csrf,
            },
            function() {
                m = 'Load was performed with ' + query;
                $('a#load_details').click(function() {
                    load_details(this);
                });
            }
        );
    }

       $('a#load_details').click(function() {
                    load_details(this);
                });
    
    function load_details() {
        /* Load infos for this particular book ... */
        url = '{% url book_websearch_detail 0 %}'
        web_id = $(this).attr('web_id');

        $.getJSON(
            url,
            function(json) {
                console.log(json);
                $('#id_title').val(json['title']);
                $('#id_description').val(json['description']);
                $('#id_author').val(json['authors']);
                $('#id_size').val(json['size']);
                $('#id_nb_pages').val(json['nb_pages']);
            }
        );
    };



    
    $('#websearch > a#go').click(websearch);
    /* TODO: Find how to handle the enter key only for input and use <form> for #websearch */
{#    $('#websearch > input#query').click(function(event) {#}
{#        event.preventDefault();#}
{#        websearch();#}
{#    });#}


{% endblock %}
