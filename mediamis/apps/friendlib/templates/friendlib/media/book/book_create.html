{% extends "friendlib/media/media_create.html" %}
{% load i18n %}

{% block media_create %}
    <legend>{% trans "Create new book" %}</legend>

    <hr>
        <div id="websearch" class="form-search" style="padding-bottom: 15px;">{% csrf_token %}
            <label>Search a book on internet ...</label>

            <input id="query" type="input-search">
            <a id="go" class="btn">Search</a>
        </div>

        <div id="websearch_result">
{#            <ul class="thumbnails">#}
{#                <li class="span2">#}
{#                    <a id="load_details" web_id="7680123456" href="#"><img src="/gbooks/example/img/medecin.jpg"/></a>#}
{#                    <a href="#">Le medecin de campagne</a>#}
{#                </li>#}
{#                <li class="span2"><img src="/gbooks/example/img/book21.jpg"/><a href="#">The Royal Tour</a></li>#}
{#                <li class="span2"><img src="/gbooks/example/img/books18.jpg"/><a href="#">Balzac</a></li>#}
{#                <li class="span2"><img src="/gbooks/example/img/books18.jpg"/><a href="#">Balzac</a></li>#}
{#                <li class="span2"><img src="/gbooks/example/img/books18.jpg"/><a href="#">Balzac</a></li>#}
{#                <li class="span2"><img src="/gbooks/example/img/books18.jpg"/><a href="#">Balzac</a></li>#}
{#            </ul>#}
        </div>
    
    <hr>
	<form class="form-horizontal" method="POST" action="{% url book_create %}">{% csrf_token %}
        <legend>Edit</legend>
        {% include "friendlib/snippets/media_form_field.html" with field=form.title %}

        {% include "friendlib/snippets/media_form_field.html" with field=form.description %}

        {% include "friendlib/snippets/media_form_field.html" with field=form.author %}

        {% include "friendlib/snippets/media_form_field.html" with field=form.size %}

        {% include "friendlib/snippets/media_form_field.html" with field=form.nb_pages %}

    
        {# Hidden fields #}
        {{ form.specialization_type }}
        {{ form.owner }}
		<input class="btn btn-primary" type="submit" value="{% trans "Create" %}" />
	</form>
{% endblock media_create %}

{% block js %}
    function websearch() {
        query = $('#websearch > input#query').val();
        csrf = $('#websearch input[name=csrfmiddlewaretoken]').val();
        console.log("Search with " + query);
        $('#websearch_result').load(
            '{% url book_websearch %}',
            {
                'action': 'search',
                'query': query,
                'csrfmiddlewaretoken': csrf,
            },
            function() {
                m = 'Load was performed with ' + query;
            }
        );
    }

    $('#websearch > a#go').click(websearch);
    /* TODO: Find how to handle the enter key only for input and use <form> for #websearch */
{#    $('#websearch > input#query').click(function(event) {#}
{#        event.preventDefault();#}
{#        websearch();#}
{#    });#}

    $('#load_details').click(function() {
        /* Load infos for this particular book ... */
        console.log("Loading info for this book ..." + $(this));
        web_id = $(this).attr('web_id');

        $.getJSON(
            '{% url book_websearch_detail 0 %}',
            { 'action': 'info', 'isbn': isbn,},
            function(json) {
                alert("JSON Data: " + json);
            }
        );
        console.log($(this).attr('isbn'));

        $('#id_title').val("Mon titre");
    });
{% endblock %}
